#!/bin/bash

## None excute mode.

if [ "$1" = "" ]; then

		
	echo "
		<< glsc : GLade Source Cooker >>

This program is make the source C and Python for glade file.

version : 0.1

help : glsc --help

Maintainer : C O S M O S project. <cosmosproject15@gmail.com>

Online help : http://cosmosproject2015.tistory.com

Thanks."
	exit 0
fi

## view help
if [ $1 = "--help" ]; then
	echo "		< glsc : GLade Source Cooker >

This program is make the source C and Python for glade file.

Version : 0.1

usage help :

	-c : making C langauge source file.
		ex: glsc -c project.glade
 
	-r : compile maked C file and run the maked program by use thee gcc & libgtk3.0+ package. 
		ex: glsc -r project
	
	-p : making python source file.
		ex: glsc -p project.glade 

Online help : http://cosmosproject2015.tistory.com

Good luck~!"
fi
	 
## check cache folder 

if [ -d ~/.cache/glsc ]; then
	echo ""	
else
	mkdir ~/.cache/glsc
fi

## cache file make

echo $2 > ~/.cache/glsc/mainc
sed -i 's/.glade//g' ~/.cache/glsc/mainc 
c3=`cat ~/.cache/glsc/mainc`
## if -c ( c language make )

if [ $1 = "-c" ]; then
	echo ""
	if [ -s $2.c ]; then
		echo "'$2.c' Source file has this folder."

		while [ : ]; do
			echo ""
			read -n 1 -p "Do you want change source file?[y/n]" cho1
			if [ $cho1 = "y" ]; then
				echo "

You chioce change source file but program make the bakup file By contrast.
mkae bakcup file '$2.c.bak'
"
				cp -f $2.c $2.c.bak
				break
			fi

			if [ $cho1 = "n" ]; then
				echo ""
				exit 0
			fi
		done
			
	fi   
	cp -f /usr/lib/glsc/src/main.c $2.c

	sed -i "s/glade/$2/g" $2.c


	cat $2 |grep '<object class="GtkWindow" id="' > ~/.cache/glsc/c1
	sed -i 's/<object class="GtkWindow" id="/ /g' ~/.cache/glsc/c1
	sed -i 's/">/ /g' ~/.cache/glsc/c1
	sed -i 's/ //g' ~/.cache/glsc/c1
	c1=`cat ~/.cache/glsc/c1`
	sed -i "s/c1/$c1/g" $2.c


	echo "void on_""$c1""_destroy()
{
    gtk_main_quit();
}" >> $2.c

## Make void handler 

	cat $2 |grep '<signal name="clicked" handler=' > ~/.cache/glsc/c2
	
	sed -i 's%<signal name="clicked" handler="%%g' ~/.cache/glsc/c2 
	sed -i 's%" swapped="no"/>%%g' ~/.cache/glsc/c2

	while [ : ]; do 
		sed -e '1d' ~/.cache/glsc/c2 > ~/.cache/glsc/c3
		sed -i 's/ //g' ~/.cache/glsc/c3
		
		ccc=`head -1 ~/.cache/glsc/c3 | tail -1`  

		if [ "$ccc" ]; then
			echo "
void $ccc()
{	

}" >> $2.c
			sed -e '1d' ~/.cache/glsc/c2 > ~/.cache/glsc/c2
		fi

		if [ -z "$ccc"]; then
			break
		fi
		
	done   
	echo "Maked source file ($2.c) successed.

How to run : 

	glsc -r $c3	

Good luck for your development~!"
	exit 0
fi

## Run for compile maked c source file.

if [ $1 = "-r" ]; then
	gcc -o $c3 $2.glade.c -Wall `pkg-config --cflags --libs gtk+-3.0` -export-dynamic
	./$c3	
	exit 0
fi	  
 

 
## Make source code for python.

if [ $1 = "-p" ]; then
	echo "" 
	if [ -s $c3.py ]; then
		echo "'$c3.py' file has this folder."
		while [ : ]; do
			echo ""		
			read -n 1 -p "Do you want change source file?[y/n]:" cho2
			if [ $cho2 = "y" ]; then
				echo "

You chioce change source file but program make the bakup file By contrast.
mkae bakcup file '$c3.py.bak'"
				cp -f $c3.py  $c3.py.bak
				break
			fi		
			if [ $cho2 = "n" ]; then
				echo ""
				exit 0
			
			fi
		done
	fi
	cp -f /usr/lib/glsc/src/glade.py $c3.py

	sed -i "s/glade/$2/g" $c3.py


	cat $2 |grep '<object class="GtkWindow" id="' > ~/.cache/glsc/p1
	sed -i 's/<object class="GtkWindow" id="/ /g' ~/.cache/glsc/p1
	sed -i 's/">/ /g' ~/.cache/glsc/p1
	sed -i 's/ //g' ~/.cache/glsc/p1
	p2=`cat ~/.cache/glsc/p1`
	sed -i "s/p2/$p2/g" $c3.py

	echo "Maked source file ($c3.py) successed.

How to run : 

	python $c3.py	

Good luck for your development~!"
	exit 0
	
fi


